/*
* @Package: Form-Analysis
* @Version: 2.1.11
* @Date: 2016-02-24
*/
if(typeof formtracker === 'undefined'){
  var formtracker,frmAnalysisLoggerForms={},formAnalysis=function(a){this.doc=document,"object"!=typeof a&&(a={}),this.forms=[],this.formIn=[],this.formOut=[],this.noFormTagConfig=!1,this.formRefreshCachedfrmconfig={};var b=[],c=[];void 0!==a.formin&&""!==a.formin&&(b=a.formin.split(",")),void 0!==a.formout&&""!==a.formout&&(c=a.formout.split(","));for(var d=0;d<b.length;d++)this.formIn.push("++"+b[d]+"++");for(var e=0;e<c.length;e++)this.formOut.push("++"+c[e]+"++");this.formIn=this.formIn.length>0?this.formIn.join(","):"",this.formOut=this.formOut.length>0?this.formOut.join(","):"",this.currentform="",this.clientSideErrorClass=void 0===a.myInputErrClassName?"error":a.myInputErrClassName,this.registerAllForms(),void 0!==a.formContainer&&""!==a.formContainer&&(this.noFormTagConfig=a.formContainer,this.registerNoFormTag(a.formContainer))};formAnalysis.prototype.refresh=function(){this.formRefreshCachedfrmconfig={};for(var a=0,b=this.forms.length;b>a;a++)frmAnalysisLoggerForms.hasOwnProperty(this.forms[a].formName)&&(this.formRefreshCachedfrmconfig[frmAnalysisLoggerForms[this.forms[a].formName]]=this.forms[a]);this.forms.length=0,this.forms=[],this.registerAllForms(),this.noFormTagConfig&&this.registerNoFormTag(this.noFormTagConfig)},formAnalysis.prototype.registerAllForms=function(){var a=this.doc.getElementsByTagName("form"),b=a.length,c=this,d="",e="",f=-1,g=Math.round(100*Math.random()-1),h=null,i=null;if(b>0){for(var j=0;b>j;j++)e=null!==a[j].getAttribute("name")&&""!==a[j].getAttribute("name")?a[j].getAttribute("name"):"",!e&&a[j].id&&(e=a[j].id),d=a[j].getAttribute("data-frmcontainer"),null!==d&&""!==d?e=d:d=!1,e&&(c.formOut&&c.formOut.indexOf("++"+e+"++")>=0||c.formIn&&c.formIn.indexOf("++"+e+"++")<0&&d===!1||this.isFormValid(a[j])&&(f++,this.forms[f]={formObj:a[j],formName:"FormNotSet",formFriendlyName:"",lastfield:"",fieldIntereactionOrder:{},started:0,allfields:[],errors:{total:0}},i=this.forms[f],i.formName=e,i.formFriendlyName=i.formName.replace(/\-|\_/gi," "),h=i.formObj.getAttribute("data-frmtrkid"),(null===h||""===h)&&(i.formObj.setAttribute("data-frmtrkid",g),h=g),frmAnalysisLoggerForms.hasOwnProperty(i.formName)&&h===frmAnalysisLoggerForms[i.formName]?(i.lastfield=this.formRefreshCachedfrmconfig[h].lastfield,i.fieldIntereactionOrder=this.formRefreshCachedfrmconfig[h].fieldIntereactionOrder,i.started=this.formRefreshCachedfrmconfig[h].started,i.allfields=this.formRefreshCachedfrmconfig[h].allfields,i.formObj===c.currentform.formObj&&(c.currentform=i)):(frmAnalysisLoggerForms[i.formName]=g.toString(),g++,this.addFieldEvents(f))));c.currentform||(c.currentform=c.forms[0])}},formAnalysis.prototype.bindFieldsEventListener=function(a,b,c){var d=this;"undefined"!=typeof window.addEventListener?b.addEventListener(a,function(a){var b=a?a:event;d.fieldIntereaction(c,b)},!1):"undefined"!=typeof window.attachEvent&&b.attachEvent("on"+a,function(a){d.fieldIntereaction(c,event)})},formAnalysis.prototype.addFieldEvents=function(a){var b=this;if(this.forms[a])for(var c=this.forms[a].formObj.getElementsByTagName("*"),d=0,e=c.length;e>d;d++)"text"===c[d].type?(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("keyup",c[d],a)):"password"===c[d].type?(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("keyup",c[d],a)):"textarea"===c[d].type?(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("keyup",c[d],a)):"radio"===c[d].type?(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("click",c[d],a)):"checkbox"===c[d].type?(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("click",c[d],a)):"select"===c[d].nodeName.toLowerCase()&&(this.forms[a].allfields.push(c[d]),b.bindFieldsEventListener("change",c[d],a))},formAnalysis.prototype.registerNoFormTag=function(a){var b=a.split(","),c="",d=this.forms.length-1,e="",f="",g=Math.round(1e3*Math.random()-1),h=null,i=null;if(b.length>0)for(var j=0,k=b.length;k>j;j++){if(f="",b[j].indexOf("#")>0)e=b[j].substring(b[j].indexOf("#")+1),f=b[j].substring(0,b[j].indexOf("#")),c=document.getElementById(e);else if(b[j].indexOf(".")>0)e=b[j].substring(b[j].indexOf(".")+1),f=b[j].substring(0,b[j].indexOf(".")),c=this.getElementsByClassName(e,f);else{if(!(b[j].indexOf("[data-frmcontainer=")>0))continue;e=b[j].substring(b[j].indexOf("[data-frmcontainer=")).replace(/\[[a-z\-\'\"]+\=(\'|\")?([a-z\-\_\s]+)(\'|\")\]/gi,"$2"),f=b[j].substring(0,b[j].indexOf("[data-frmcontainer=")),c=this.getElementsByDataSet(e,f)}if(c){if(d++,this.forms[d]={formObj:c,formName:"FormNotSet",formFriendlyName:"",lastfield:"",fieldIntereactionOrder:{},started:0,allfields:[],errors:{total:0}},i=this.forms[d],i.formName=e,i.formFriendlyName=i.formName.replace(/\-|\_/gi," "),h=i.formObj.getAttribute("data-frmtrkid"),(null===h||""===h)&&(i.formObj.setAttribute("data-frmtrkid",g),h=g),frmAnalysisLoggerForms.hasOwnProperty(i.formName)&&h===frmAnalysisLoggerForms[i.formName]){i.lastfield=this.formRefreshCachedfrmconfig[h].lastfield,i.fieldIntereactionOrder=this.formRefreshCachedfrmconfig[h].fieldIntereactionOrder,i.started=this.formRefreshCachedfrmconfig[h].started,i.allfields=this.formRefreshCachedfrmconfig[h].allfields,i.formObj===this.currentform.formObj&&(this.currentform=i);continue}frmAnalysisLoggerForms[i.formName]=g.toString(),g++,this.addFieldEvents(d)}}},formAnalysis.prototype.getElementsByClassName=function(a,b){var c="";if("function"!=typeof document.getElementsByClassName){if("object"==typeof document.querySelector||"function"==typeof document.querySelector){if(c=document.querySelector("."+a),"null"!==c)return c}else for(var d=document.getElementsByTagName(b),e=0,f=d.length;f>e;e++)if(d[e].className&&""!==d[e].className&&d[e].className.indexOf(a)>=0)return d[e]}else if(c=document.getElementsByClassName(a),c.length>0)return c[0];return""},formAnalysis.prototype.getElementsByDataSet=function(a,b){var c;if("object"==typeof document.querySelector||"function"==typeof document.querySelector){if(c=document.querySelector('[data-frmcontainer="'+a+'"]'),"null"!=typeof c)return c}else for(var d=document.getElementsByTagName(b),e=0,f=d.length;f>e;e++)if(null!==d[e].getAttribute("data-frmcontainer")&&""!==d[e].getAttribute("data-frmcontainer")&&d[e].getAttribute("data-frmcontainer").indexOf(a)>=0)return d[e];return""},formAnalysis.prototype.fieldIntereaction=function(a,b){b=b.srcElement?b.srcElement:b.target,this.currentform&&this.currentform.formObj===this.forms[a].formObj||(this.currentform=this.forms[a]),this.forms[a].lastfield=b;var c=b.getAttribute("name"),d=b.getAttribute("data-formfieldname");null!==c&&c||(c=b.id),null!==d&&""!==d&&(c=d),c||(c="Field name not set"),c&&!this.currentform.fieldIntereactionOrder.hasOwnProperty(c)&&(this.currentform.fieldIntereactionOrder[c]=1),this.currentform.started||this.start()},formAnalysis.prototype.getFormInstance=function(a){var b=0;if(this.forms.length>0)for(var c=0,d=this.forms.length;d>c;c++){if(null!==this.forms[c].formObj.getAttribute("name")&&this.forms[c].formObj.getAttribute("name")===a){b=this.forms[c];break}if(this.forms[c].formObj.id&&this.forms[c].formObj.id===a){b=this.forms[c];break}}return b||console.log("form could not be found - "+a),b},formAnalysis.prototype.getFormInteractionOrder=function(){var a=this.currentform.fieldIntereactionOrder,b=[];for(var c in a)b.push(c);return b.length>0?b.join("|"):"No Field Interaction"},formAnalysis.prototype.start=function(){if(this.setStartTime("form"),this.currentform.started=1,"function"==typeof window.frmTrkcbFormStart){var a=window.frmTrkcbFormStart;a(this.currentform.formName)}},formAnalysis.prototype.abandon=function(){var a={formName:this.currentform.formName,formLastField:{name:"NA",value:"NA"},formFieldInteractionOrder:this.getFormInteractionOrder(),timeToComplete:this.getTimetoComplete("form"),errorsTotal:0,errorsFields:""},b="",c="";if(!this.currentform)return!1;if(void 0!==this.currentform.lastfield.type&&(b=this.currentform.lastfield.getAttribute("name"),c=this.currentform.lastfield.getAttribute("data-formfieldname"),null!==b&&b||(b=this.currentform.lastfield.id,b||(b="Field name not set")),null!==c&&""!==c&&(b=c),a.formLastField.name=b,"password"!==this.currentform.lastfield.type?a.formLastField.value=this.currentform.lastfield.value:a.formLastField.value="pwdfield"),this.currentform.errors.total>0){var d=[];a.errorsTotal=this.currentform.errors.total;for(var e in this.currentform.errors)"total"!==e&&d.push(e+":"+this.currentform.errors[e]);d.length>0&&(a.errorsFields+=d.join("|"))}return a},formAnalysis.prototype.logFormErrors=function(a,b){var c,d;a===!1&&(c=null!==b.getAttribute("name")&&b.getAttribute("name")?b.getAttribute("name"):b.id,d=this.getFormInstance(c),d&&(this.currentform=this.getFormInstance(c)),this.lookForErrorFields())},formAnalysis.prototype.lookForErrorFields=function(){if(this.currentform&&this.currentform.hasOwnProperty("allfields")&&this.currentform.allfields.length>0)for(var a="",b="",c=0,d=this.currentform.allfields.length;d>c;c++)a=this.currentform.allfields[c],a.getAttribute("class")&&a.className.indexOf(this.clientSideErrorClass)>=0&&(b=null!==a.getAttribute("name")&&""!==a.getAttribute("name")?a.getAttribute("name"):a.id?a.id:"Undefined field",this.currentform.errors.hasOwnProperty(b)?this.currentform.errors[b]+=1:this.currentform.errors[b]=1,this.currentform.errors.total+=1)},formAnalysis.prototype.isFormValid=function(a){var b=a.getElementsByTagName("input"),c=a.getElementsByTagName("select"),d=!1,e="";if(b.length>0)for(var f=0,g=b.length;g>f;f++)if(e=b[f].type.toLowerCase(),"text"==e||"password"==e||"radio"==e||"checkbox"==e||"textarea"==e){d=!0;break}return c.length>0&&(d=!0),d},formAnalysis.prototype.setStartTime=function(a){"form"===a?document.cookie="fmrAnaformStart="+(new Date).getTime()+"; path=/;":"application"===a&&(document.cookie="fmrAnaApplicationStart="+(new Date).getTime()+"; path=/;")},formAnalysis.prototype.getTimetoComplete=function(a){var b=document.cookie.split(";"),c="",d=0,e=0;"form"===a?c="fmrAnaformStart=":"application"===a&&(c="fmrAnaApplicationStart=");for(var f=0,g=b.length;g>f;f++){for(var h=b[f];" "===h.charAt(0);)h=h.substring(1);if(b[f].indexOf(c)>=0){d=h.substring(c.length,h.length);break}}return"form"===a?document.cookie="fmrAnaformStart=0; path=/;;expires=Thu, 01-Jan-1970 00:00:01 GMT":"application"===a&&(document.cookie="fmrAnaApplicationStart=0; path=/;;expires=Thu, 01-Jan-1970 00:00:01 GMT"),void 0!==this.currentform&&(this.currentform.started=0),e=d?parseInt(((new Date).getTime()-d)/1e3):d,0===e?e:60>e?e+(e>1?" seconds":" second"):(e=Math.round(e/60*100)/100,e+(e>1?" minutes":" minute"))};
}
// Make a call to the page function - this will avoid making a doc ready or win load to kick start the process
// lets wait until the above is made available to the page
if(typeof window['frmTrkFormReady'] === 'function'){
  //console.log('CB function is avalable');
	frmTrkFormReady();
}
